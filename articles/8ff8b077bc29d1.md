---
title: "Claude artifacts で TailwindCSS の CDN を利用する"
emoji: "🎃"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# 結論から

https://cdnjs.com/libraries/tailwindcss-browser の `https://cdnjs.cloudflare.com/ajax/libs/tailwindcss-browser/4.1.11/index.global.js` を利用するように指示しましょう。

## 詳しく

公式 Docs だと https://tailwindcss.com/docs/installation/play-cdn にて

```html
<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body>
    <h1 class="text-3xl font-bold underline">
      Hello world!
    </h1>
  </body>
</html>
```

と記載があるため、このまま依頼すると、Artifacts のプレビューで TailwindCSS の CSS が適用されません。

Claude Opus 4.1 に確認してもらったところ、以下の通り、利用できる cdn は `cdnjs.cloudflare.com` のみとのことです。
うまく伝えないと2系や3系で生成されるので、事前に指示しておくのが良さそうです。

---

# Tailwind CSS v4がClaude Artifactsで動作しない技術的理由

Claude ArtifactsでTailwind CSS v4 (@tailwindcss/browser@4) CDNが動作しない問題は、**セキュリティ制限とアーキテクチャの根本的な非互換性**に起因しています。この調査により、実行環境の制限とライブラリの技術要件の間に深刻な不一致があることが判明しました。

## 最も重要な発見：CDNホワイトリスト制限

Claude Artifactsは**cdnjs.cloudflare.comのみを外部JavaScriptソースとして許可**しており、これが問題の核心です。Tailwind CSS v4の@tailwindcss/browser@4パッケージは通常、以下のCDNから配信されます：
- cdn.jsdelivr.net
- unpkg.com
- esm.sh

これらはすべてClaude Artifactsでブロックされているため、ライブラリ自体を読み込むことすらできません。仮にcdnjs.cloudflare.comでホストされたとしても、さらに深刻な技術的障壁が存在します。

## Tailwind CSS v4の新アーキテクチャが求める高度な機能

### WebAssemblyベースのOxideエンジン

Tailwind CSS v4は、パフォーマンスを大幅に向上させるため、**Rustで書かれたOxideエンジンをWebAssemblyとして実行**します。これにより、v3と比較して：
- フルリビルドが**3.5倍高速**
- インクリメンタルビルドが**8倍高速**

しかし、Claude Artifactsのサンドボックス環境は以下の理由でWebAssembly実行を制限しています：

**Content Security Policy (CSP)による制限**：Claude Artifactsは`wasm-unsafe-eval`ディレクティブを許可していないため、`WebAssembly.compile()`や`WebAssembly.instantiateStreaming()`などの関数がブロックされます。これらはTailwind v4のコア機能に必須です。

**nullオリジンの影響**：サンドボックス化されたiframeは`null`オリジンを持つため、WebAssemblyモジュールの読み込みやWorkerの生成が不可能です。

### 動的コンパイルとコード生成

Tailwind CSS v4は、以下のような動的コード生成パターンを使用します：

```javascript
// ランタイムでのCSS生成（制限環境で失敗）
new Function('styles', `return \`${cssTemplate}\``);

// 動的インポート（CSPでブロック）
import(`./plugins/${pluginName}.js`);
```

Claude Artifactsのセキュリティポリシーは、**eval()、Function()コンストラクタ、動的インポート**をすべてブロックします。これらはXSSやコードインジェクション攻撃のベクトルとなる可能性があるためです。

## Tailwind CSS v3との決定的な違い

### v3のシンプルなJavaScriptベースJITコンパイラ

Tailwind CSS v3のPlay CDN（https://cdn.tailwindcss.com）は、純粋なJavaScriptで実装されたJust-In-Timeコンパイラを使用していました。これは：
- WebAssemblyを必要としない
- 基本的なDOM操作とJavaScript実行のみで動作
- UMD形式で配布され、制限環境と互換性がある

### アーキテクチャ比較

| 機能 | Tailwind CSS v3 | Tailwind CSS v4 |
|------|----------------|-----------------|
| **コンパイラエンジン** | JavaScript JIT | Rust/WebAssembly (Oxide) |
| **CDN配信** | cdn.tailwindcss.com | @tailwindcss/browser@4 (npm CDN) |
| **動的コード生成** | 限定的 | 広範囲に使用 |
| **ブラウザ要件** | 幅広い互換性 | 2023年以降のモダンブラウザ |
| **CSP要件** | 基本的なスクリプト実行 | wasm-unsafe-eval必須 |

## Claude Artifactsの実行環境制限の詳細

### サンドボックスアーキテクチャ

Claude Artifactsは多層セキュリティモデルを採用しています：

**iframeサンドボックス属性**：`sandbox`属性により、以下が制限されます：
- フォーム送信（`allow-forms`なし）
- ファイルダウンロード
- ポップアップウィンドウ
- 外部リソースへのアクセス

**プロセス分離**：フルサイト・プロセス分離により、メインのClaude.aiセッションから完全に隔離されています。

**ネットワーク制限**：
- 外部APIへのfetch()やXMLHttpRequestがブロック
- CORSポリシーにより、ほとんどのクロスオリジンリクエストが拒否
- cdnjs.cloudflare.com以外のCDNからのリソース読み込みが禁止

### JavaScript実行制限

以下のJavaScript機能が使用できません：
- **localStorage/sessionStorage**：nullオリジンのためアクセス不可
- **Service Worker**：登録不可能
- **Web Worker**：外部スクリプトからの生成不可
- **動的スクリプト挿入**：CSPにより制限

## 他のCDNライブラリとの互換性パターン

### 動作するライブラリの共通点

Claude Artifactsで正常に動作するライブラリは以下の特徴を持ちます：

1. **UMD（Universal Module Definition）形式**での配布
2. **自己完結型**で外部依存関係が最小限
3. **cdnjs.cloudflare.comで利用可能**
4. **同期的な読み込みと実行**パターン

例：jQuery、Lodash、D3.js、Chart.jsなどは、これらの条件を満たすため正常に動作します。

### 失敗するライブラリのパターン

以下の特徴を持つライブラリは動作しません：

1. **ESモジュール形式**のみの配布
2. **動的インポート**や**コード生成**への依存
3. **WebAssembly**の使用
4. **Node.js API**への依存

## 実用的な解決策と回避策

### 即座に実装可能な対策

**1. Tailwind CSS v3の使用を継続**
```html
<!-- cdnjsからv3を読み込む（動作確認済み） -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
```

**2. 事前コンパイル済みCSSの使用**
開発環境でTailwind CSS v4を使用してCSSを生成し、静的CSSとしてClaude Artifactsに組み込む。

**3. Claude Artifact Runnerの活用**
Claudio Silvaによるオープンソースプロジェクトを使用して、ローカル環境でClaude Artifactsを実行し、制限を回避。

### 長期的な解決策

**1. cdnjs.cloudflare.comへの追加を待つ**
Tailwind CSS v4がcdnjsに追加されても、WebAssemblyとコード生成の制限により完全な動作は期待できません。

**2. 制限を考慮した開発フロー**
- Claude Artifactsでプロトタイピング
- ローカル環境で本格的な開発
- 最終的なコードを再度Artifactsで確認

**3. 代替CSSフレームワークの検討**
UMD形式で配布され、動的コンパイルを必要としないCSSフレームワークの使用。

## 結論

Tailwind CSS v4がClaude Artifactsで動作しない理由は、**セキュリティファーストの設計思想と、モダンWebフレームワークの高度な機能要求の間の根本的な対立**にあります。Claude Artifactsの制限は、悪意のあるコード実行を防ぐために必要不可欠ですが、同時に正当な開発ツールの使用も制限してしまいます。

この問題は技術的な回避策では完全に解決できず、**プラットフォームレベルでのセキュリティポリシーの見直し**か、**フレームワーク側でのサンドボックス対応版の開発**が必要です。現時点では、Tailwind CSS v3の使用か、事前コンパイル済みCSSの利用が最も実用的な解決策となります。

開発者は、Claude Artifactsを**高速プロトタイピングツール**として位置づけ、本格的な開発は制限のない環境で行うという使い分けが重要です。
